<!DOCTYPE html>
<html lang="zh-cn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="index.css">
    <title>查重小工具</title>
</head>

<body>
    <header>
        <h1>查重小工具</h1>
    </header>
    <main>
        <div class="wapper clearfix">
            <div class="boxA">
                <div class="option">
                    <input type="file" accept=".txt">
                    <button class="load">上传文件</button>
                    <button class="clear">清空</button>
                </div>
                <div class="editor" id="textA" contenteditable="true"></div>
            </div>
            <button id="comfirm">查重</button>
            <div class="boxB">
                <div class="option">
                    <input type="file" accept=".txt">
                    <button class="load">上传文件</button>
                    <button class="clear">清空</button>
                </div>
                <div class="editor" id="textB" contenteditable="true"></div>
            </div>
            <div id="result"></div>
        </div>
    </main>
    <footer></footer>
    <script src="algorithm.js"></script>
    <script>
        document.getElementById('comfirm').addEventListener('click', function () {
            let lcs = LCS();
            let a = document.getElementById('textA').innerText.split('');
            let b = document.getElementById('textB').innerText.split('');
            lcs.setArrayA(a);
            lcs.setArrayB(b);
            let result = lcs.getLCSString();
            let repeatA = lcs.getRepeatA();
            for (index of repeatA) {
                a[index] = `<i>${a[index]}</i>`;
            }
            let repeatB = lcs.getRepeatB();
            for (index of repeatB) {
                b[index] = `<i>${b[index]}</i>`;
            }
            document.getElementById('textA').innerHTML = a.join('');
            document.getElementById('textB').innerHTML = b.join('');
            document.getElementById('result').innerHTML = `<h4>重复部分为</h4><p>${result}</p><h4>重复率：<span class="number">${lcs.getPercentage()}%</span></h4>`;
        });
        let loadFile = document.getElementsByClassName('load');
        for (let i = 0; i < loadFile.length; i++) {
            loadFile[i].addEventListener('click', function () {
                this.previousElementSibling.click();
            })
        }
        let fa = document.querySelector('.boxA > div.option > input[type=file]');
        let fb = document.querySelector('.boxB > div.option > input[type=file]');
        fa.onchange = function () {
            let file = this.files[0];
            let reader = new FileReader();
            reader.readAsText(file, 'utf-8');
            reader.onload = function () {
                let string = reader.result;
                document.getElementById('textA').innerHTML = string;
            }
        }
        fb.onchange = function () {
            let file = this.files[0];
            let reader = new FileReader();
            reader.readAsText(file, 'utf-8');
            reader.onload = function () {
                let string = reader.result;
                document.getElementById('textB').innerHTML = string;
            }
        }
        let clearButts = document.getElementsByClassName('clear');
        for (let i = 0; i < clearButts.length; i++) {
            clearButts[i].addEventListener('click', function () {
                this.parentElement.parentElement.lastElementChild.innerHTML = '';
            })
        }
    </script>
</body>

</html>